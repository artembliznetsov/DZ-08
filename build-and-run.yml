---
- hosts:
    - build-server
    - run-server
  become: yes
  tasks:
    - name: Install Docker
      apt:
        name:
          - docker.io
          - python-pip

    - name: Install docker-py
      pip:
        name: docker-py

- hosts:
    - build-server
  become: yes
  tasks:
    - name: Clone repository
      git:
        repo: 'https://github.com/artembliznetsov/DZ-07.git'
        dest: /opt/boxfuse

    - name: Build image
      docker_image:
        name: boxfuse_builder
        path: /opt/boxfuse
        dockerfile: Dockerfile_build

    - name: Run build container
      docker_container:
        name: boxfuse_builder
        image: boxfuse_builder
        state: present
        volumes:
          - /opt/boxfuse:/opt
        auto_remove: yes

